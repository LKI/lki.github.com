<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Hugo 0.82.0" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="Lirian Su" />
  <meta property="og:url" content="https://liriansu.com/posts/2017-03-18-hawk-authentication/" />
  <link rel="canonical" href="https://liriansu.com/posts/2017-03-18-hawk-authentication/" /><script type="application/ld+json">
  {
      "@context" : "https://schema.org",
      "@type" : "BlogPosting",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https:\/\/liriansu.com\/"
      },
      "articleSection" : "posts",
      "name" : "一种轻量级的Http加密方式：Hawk",
      "headline" : "一种轻量级的Http加密方式：Hawk",
      "description" : "\u003cp\u003e这是一篇关于\u003ca href=\u0022https:\/\/github.com\/hueniverse\/hawk1\u0022\u003eHawk\u003c\/a\u003e的简短介绍。\u003c\/p\u003e",
      "inLanguage" : "en-US",
      "author" : "Lirian Su",
      "creator" : "Lirian Su",
      "publisher": "Lirian Su",
      "accountablePerson" : "Lirian Su",
      "copyrightHolder" : "Lirian Su",
      "copyrightYear" : "2017",
      "datePublished": "2017-03-18 23:55:18 \u002b0000 UTC",
      "dateModified" : "2017-03-18 23:55:18 \u002b0000 UTC",
      "url" : "https:\/\/liriansu.com\/posts\/2017-03-18-hawk-authentication\/",
      "keywords" : [  ]
  }
</script>
<title>一种轻量级的Http加密方式：Hawk - 浮云计算</title>
  <meta property="og:title" content="一种轻量级的Http加密方式：Hawk - 浮云计算" />
  <meta property="og:type" content="article" />
  <meta name="description" content="这是一篇关于Hawk的简短介绍。" />

  <link rel="stylesheet" href="/css/flexboxgrid-6.3.1.min.css" />
  <link rel="stylesheet"
    href="/css/github-markdown.min.css" />
  <link rel="stylesheet" href="/css/highlight/tomorrow.min.css" />
  <link rel="stylesheet" href="/css/index.css">
  <link href="/index.xml" rel="alternate" type="application/rss+xml" title="浮云计算">
  
  <link href="https://fonts.googleapis.com/css?family=Arvo|Permanent+Marker" rel="stylesheet">
  
  

  
</head>


<body>
  <article class="post 中文" id="article">
    <div class="row">
      <div class="col-xs-12 col-sm-10 col-md-8 col-sm-offset-1 col-md-offset-2 col-lg-6 col-lg-offset-3">
        <div class="site-header">
          <header>
  <div class="signatures site-title">
    <a href="/">Lirian Su</a>
  </div>
</header>
<div class="row end-xs site-header-right">
  
  <div class="site-header-item">
    <a href="/about" target="_blank">about</a>
  </div>
  
  <div class="site-header-item">
    <a href="https://github.com/LKI" target="_blank">github</a>
  </div>
  
  <div class="site-header-item">
    <a href="https://www.zhihu.com/people/liriansu" target="_blank">zhihu</a>
  </div>
  
  <div class="site-header-item">
    <a href="/index.xml" target="_blank">rss</a>
  </div>
  
</div>
<div class="header-line"></div>

        </div>
        <header class="post-header">
          <h1 class="post-title">一种轻量级的Http加密方式：Hawk</h1>
          
          <div class="row post-desc">
            
            <time class="post-header-item" datetime="2017-03-18 23:55:18 UTC">
              Written at 2017-03-18 23:55
            </time>
            
            <span class="post-header-item" id="busuanzi_container_page_pv"> Views <span id="busuanzi_value_page_pv" /> </span>
          </div>
          
        </header>

        <div class="post-content markdown-body">
          <p>这是一篇关于<a href="https://github.com/hueniverse/hawk1">Hawk</a>的简短介绍。</p>

<h2 id="什么是hawk">什么是Hawk</h2>

<p><a href="https://github.com/hueniverse/hawk1">Hawk</a>是一种轻量级的Http加密方式，<br />
这里的轻量级是针对于OAuth / Digest这种加密方式而言。<br />
<a href="https://github.com/hueniverse/hawk1">Hawk</a>主要防范的是中间人攻击，<br />
它基于服务器和客户端共有的秘钥，<br />
在时间戳的基础上对请求加密，<br />
生成互相匹配的特征码。</p>

<p><a href="https://github.com/hueniverse/hawk1">Hawk</a>的好处是整个加密的过程对计算能力要求不高，<br />
用到的也是简单的sha256算法。<br />
而且它可以只针对单个请求加密，<br />
所以应用场景十分灵活。</p>

<p>在一个典型的<a href="https://github.com/hueniverse/hawk1">Hawk</a>应用场景中，<br />
客户端首先通过某种方式跟服务端通信，<br />
获取秘钥。<br />
在之后的Http请求中，<br />
客户端对请求采用Hawk加密，<br />
并且把基本信息放在Http Header里。<br />
服务器收到请求以后，<br />
采用同样的方式进行加密比对，<br />
假如两边都对上了，<br />
则是一个合法请求。<br />
否则返回<code>401 Unauthorized</code></p>

<h2 id="加密算法">加密算法</h2>

<p><a href="https://github.com/hueniverse/hawk1">Hawk</a>协议规定的加密方式如下：</p>

<p>这是一个样例的HTTP GET请求：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#960050;background-color:#1e0010">GET https://example.com:8000/resource/1?b=1&amp;a=2</span></code></pre></div>
<p>要通过Hawk验证，<br />
我们会把请求的特征用换行符拼接成如下格式，<br />
最后再用<code>HMAC sha256</code>进行加密：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#960050;background-color:#1e0010">hawk.1.header
</span><span style="color:#960050;background-color:#1e0010">1353832234
</span><span style="color:#960050;background-color:#1e0010">j4h3g2
</span><span style="color:#960050;background-color:#1e0010">GET
</span><span style="color:#960050;background-color:#1e0010">/resource/1?b=1&amp;a=2
</span><span style="color:#960050;background-color:#1e0010">example.com
</span><span style="color:#960050;background-color:#1e0010">8000
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">some-app-ext-data</span></code></pre></div>
<p>其中<code>hawk.1.header</code>是表示用version为1的hawk来加密header，<br />
<code>1353832234</code>是unix timestamp，<br />
<code>j4h3g2</code>是客户端生成的随机字符串，<br />
<code>GET</code>是请求类型，<br />
<code>/resource/1?b=1&amp;a=2</code>是请求的query，<br />
<code>example.com</code>和<code>8000</code>分别是host和port，<br />
而<code>some-app-ext-data</code>是约定好要验证的额外内容（可为空）。<br />
上面这段字符串是大小写敏感，空格敏感且换行敏感的。</p>

<p>假如说我们的秘钥是<code>werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn</code>，<br />
则上面的样例请求经过<code>HMAC sha256</code>加密后的特征码会是<code>6R4rV5iE+NPoym+WwjeHzjAGXUtLNIxmo1vpMofpLAE=</code></p>

<p>最后我们把基本信息加入Http Header里，<br />
请求就会变成这样子：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#960050;background-color:#1e0010">GET https://example.com:8000/resource/1?b=1&amp;a=2
</span><span style="color:#960050;background-color:#1e0010">Authorization: Hawk id=&#34;dh37fgj492je&#34;, ts=&#34;1353832234&#34;, nonce=&#34;j4h3g2&#34;, ext=&#34;some-app-ext-data&#34;, mac=&#34;6R4rV5iE+NPoym+WwjeHzjAGXUtLNIxmo1vpMofpLAE=&#34;</span></code></pre></div>
<p>服务器端拿到<code>HttpHeader.Authorization</code>以后进行加密比对即可。</p>

<h2 id="其它事项">其它事项</h2>

<ul>
<li>Hawk提供Payload Validation，协议中指定的加密方式是<code>sha256</code>，与header的加密方式<code>HMAC sha256</code>不一样。<br /></li>
<li>假如客户端和服务器的Timestamp不一样，服务器应当返回Timestamp，由客户端计算时间差后再次请求。<br /></li>
<li>具体使用中可恰当魔改Hawk请求，比如增加对id的验证等。<br />
<br />
<br /></li>
</ul>
        </div>

        
          

          
          <div style="height: 20px;"></div>
        

        



<div class="post-comments">
  <script src="https://utteranc.es/client.js"
          repo="LKI/lki.github.io"
          issue-term="title"
          label="comment"
          theme="github-light"
          crossorigin="anonymous"
          async>
  </script>
</div>


        

<div class="site-footer">
  <div class="site-footer-left">
    <div class="site-footer-item">
      <span id="busuanzi_container_site_pv" style="display:none"> PV: <span id="busuanzi_value_site_pv"/> </span>
    </div>
    <div class="site-footer-item">
      <span id="busuanzi_container_site_uv" style="display:none"> UV: <span id="busuanzi_value_site_uv"/> </span>
    </div>
  </div>

  <div class="site-footer-right">
    
    
    <div class="site-footer-item">
      <a href="/en/">English</a>
    </div>
    
    
  </div>
</div>

      </div>
    </div>
  </article>

  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

</body>

</html>
